{% extends 'pedidos/base.html' %}

{% block content %}
  <h1 class="text-center display-4 mb-5">Meu Carrinho</h1>

  <div class="row">
    <div class="col-12 col-md-8">
      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">Produto</th>
            <th scope="col">Preço</th>
            <th scope="col">Quantidade</th>
            <th scope="col">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item, produto in itemcarrinho %}
            <tr>
              <td>
                <div class="media">
                  {% with imagem=item.produto.produtoimagem_set.first %}
                  {% if imagem %}
                    <img src="{{ imagem.imagem.url }}" alt="{{ item.produto.nome }}" style="max-width: 15%;">
                  {% else %}
                    <img src="{{ item.produto.imagem_principal.url }}" alt="{{ item.produto.nome }}">
                  {% endif %}
                {% endwith %}
                  <div class="media-body">
                    <p class="mb-0">{{ produto.produto }}</p>
                  </div>
                </div>
              </td>
              <td>R$ {{ produto.preco }}</td>
              <td>
                <form method="POST" action="{% url 'exibir_carrinho' %}">
                  {% csrf_token %}
                  <div class="form-group mb-0">
                    <input type="hidden" name="item{{ item.id }}" value="{{ item.id }}">
                    <input type="number" name="quantidade{{ item.id }}" class="form-control" value="{{ item.quantidade }}" min="1" max="{{ produto.quantidade_em_estoque }}" required oninvalid="this.setCustomValidity('Valor acima do disponível. O total em estoque é de {{produto.quantidade_em_estoque}}')" oninput="this.setCustomValidity('')">

                  </div>
                  
                  <button type="submit" class="btn btn-primary mt-2">Atualizar</button>
                </form>
              </td>
              <td>R$ {{ item.total_item }}</td>
            </tr>
          {% endfor %}
          <tr>
            <td colspan="3" class="text-right font-weight-bold">Total:</td>
            <td class="font-weight-bold text-success">R$ {{ total_pedido }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block sidebar %}
  <!-- coloque aqui o conteúdo específico do sidebar do template do carrinho -->
{% endblock %}
