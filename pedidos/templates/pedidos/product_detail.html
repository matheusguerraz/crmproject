{% extends 'pedidos/base.html' %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-6">
      {% if produto.imagem_set.all %}
      <div id="carousel-{{ produto.id }}" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          {% for imagem in produto.imagem_set.all %}
          <li data-target="#carousel-{{ produto.id }}" data-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active"{% endif %}></li>
          {% endfor %}
        </ol>
        <div class="carousel-inner">
          {% for imagem in produto.imagem_set.all %}
          <div class="carousel-item{% if forloop.first %} active{% endif %}">
            <img class="d-block w-100" src="{{ imagem.imagem.url }}" alt="{{ produto.produto }}">
          </div>
          {% endfor %}
        </div>
        <a class="carousel-control-prev" href="#carousel-{{ produto.id }}" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Anterior</span>
        </a>
        <a class="carousel-control-next" href="#carousel-{{ produto.id }}" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Próximo</span>
        </a>
      </div>
      {% else %}
      <p>Este produto não tem imagem associada</p>
      {% endif %}
    </div>
    
   
    <div class="col-md-6">
      <h2>{{ produto.produto }}</h2>
      <p><strong>Marca:</strong> {{ produto.marca }}</p>
      <p><strong>Sabor:</strong> {{ produto.sabor }}</p>
      <p><strong>Preço:</strong> R$ {{ produto.preco }}</p>
      <p><strong>Descrição:</strong> {{ produto.descricao }}</p>
      <form method="post">
        {% csrf_token %}
        <button id="add-to-cart-btn" class="buy-button" data-produto-id="{{ produto.id }}">Adicionar ao carrinho</button>
      </form>
    </div>
  </div>
</div>

{% block scripts %}
  <script>
    $(document).ready(function() {
      $('.buy-button').click(function(event) {
        event.preventDefault();
        var productId = $(this).data('produto-id');
        $.ajax({
          url: '/adicionar-ao-carrinho/',
          method: 'POST',
          data: {product_id: productId},
          success: function(data) {
            alert('Produto adicionado ao carrinho com sucesso!');
          },
          error: function() {
            alert('Ocorreu um erro ao adicionar o produto ao carrinho!');
          }
        });
      });
    });
  </script>
{% endblock %}

{% endblock %}
