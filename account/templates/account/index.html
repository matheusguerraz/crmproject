{% extends 'account/base.html' %}
{% load static %}
{% block content %}

<head>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card border-success">
        <div class="card-header bg-transparent border-success text-center">
          <h3>Dados pessoais</h3>
        </div>
        <div class="card-body">

          <form id="signup-form" method="post">
            {% csrf_token %}

            <div class="form-group">
              <label for="form.name.id_for_label" placeholder="Nome completo" required style="font-size: 24px; padding: 16px; border: 2px solid #008000; box-shadow: 0px 0px 8px #008000; font-weight: bold; width: 100%;">
              {{form.name}}

            {% if form.name.errors %}
                <div class="alert alert-danger">
                    {% for error in form.name.errors %}
                    <span>{{ error }}</span><br>
                    {% endfor %}
                </div>
            {% endif %}

            </div>

            <div class="form-group">
              <label for="form.email.id_for_label" placeholder="E-mail" required style="font-size: 24px; padding: 16px; border: 2px solid #008000; box-shadow: 0px 0px 8px #008000; font-weight: bold; width: 100%;">
                {{form.email}}

                {% if form.email.errors %}
                <div class="alert alert-danger">
                    {% for error in form.email.errors %}
                    <span>{{ error }}</span><br>
                    {% endfor %}
                </div>
            {% endif %}
            
            </div>

            <div class="form-group">
              <label for="form.date_of_birth.id_for_label" placeholder="Data de nascimento" required style="font-size: 24px; padding: 16px; border: 2px solid #008000; box-shadow: 0px 0px 8px #008000; font-weight: bold; width: 100%;">
              {{form.date_of_birth}}

              {% if form.date_of_birth.errors %}
              <div class="alert alert-danger">
                  {% for error in form.date_of_birth.errors %}
                  <span>{{ error }}</span><br>
                  {% endfor %}
              </div>
          {% endif %}


            </div>

            <div class="form-group">
              <label for="form.password1.id_for_label" placeholder="Senha" required style="font-size: 24px; padding: 16px; border: 2px solid #008000; box-shadow: 0px 0px 8px #008000; font-weight: bold; width: 100%;">
                {{form.password1}}
                
                {% if form.password1.errors %}
                <div class="alert alert-danger">
                    {% for error in form.password1.errors %}
                    <span>{{ error }}</span><br>
                    {% endfor %}
                </div>
            {% endif %}

            </div>

            <div class="form-group">
              <label for="form.password2.id_for_label" type="date" placeholder="Confirme a senha" required style="font-size: 24px; padding: 16px; border: 2px solid #008000; box-shadow: 0px 0px 8px #008000; font-weight: bold; width: 100%;">
                {{form.password2}}

                
                {% if form.password2.errors %}
                <div class="alert alert-danger">
                    {% for error in form.password2.errors %}
                    <span>{{ error }}</span><br>
                    {% endfor %}
                </div>
            {% endif %}

            </div>

            <button type="submit" class="btn btn-success btn-block" style="font-size: 24px; padding: 16px;">Cadastrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
    function sendForm() {
  var form = document.getElementById('signup-form');
  var formData = new FormData(form);

  var xhr = new XMLHttpRequest();
  xhr.open('POST', form.action, true);
  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
  xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
  xhr.send(formData);

  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        // Sucesso
      } else {
        // Erro
      }
    }
  }
}

    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
        }
        }
    }
    return cookieValue;
    }

    $(function () {
      $('#signup-form').submit(function (event) {
        event.preventDefault(); // previne o envio do formulário
        $.ajax({
          type: 'POST',
          url: '{% url "account" %}',
          data: $(this).serialize(), // pega os dados do formulário
          success: function () {
            // Mostra a modal com a mensagem de sucesso
            $('#signup-success-modal').modal('show');
  
            // Redireciona após 3 segundos
            setTimeout(function(){
                window.location.href = "{% url 'product_list' %}";
            }, 3000);
          },
          error: function () {
            // Mostra a modal com a mensagem de erro
            $('#signup-error-modal').modal('show');
          }
        });
      });
    });
  </script>
  
{% endblock %}
